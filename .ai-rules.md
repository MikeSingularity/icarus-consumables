# Icarus Food Data Parser: AI Rules

This document defines context, workflows, and standards for developing the Icarus consumables guide.

## üöÄ Workflows (Slash Commands)
- `/run-parser`: Execute via `uv run python3 main.py`.
- `/test`: Run suite via `uv run python3 tests/...`.
- `/verify`: Validate integrity via `tests/verify_integrity.py`.

## üõ† Coding Standards
- **Python**: PEP8 compliant, max line width **120 characters**.
- **Documentation**: Mandatory **tall** docstrings for all classes and functions.
- **Typing**: Use type hints. Prefer `dict`/`list` over `Dict`/`List` (Python 3.14+).
- **Environment**: Use `uv` for dependency management; honor `pyproject.toml`.
- **Paths**: **ALWAYS** use `pathlib.Path`. Resolve via `icarus_consumables.utils.path_resolver`.

## üèó Project Architecture
- `src/`: Modular source packages.
- `tests/`: Integrity and unit tests.
- `output/`: Generated `.json`/`.csv`/`.ods` files.
- `overrides/`: JSON templates for visibility and manual value overrides.
- `unpacked_icarus_data/`: Source game data (JSON). **DO NOT COMMIT**.

## üìä Core Logic
### Category Order (First Match)
1. **Animal Food**: Has `BaseFoodRecovery` + "Animal" or "Omni" in name.
2. **Food**: Has `BaseFoodRecovery`.
3. **Drink**: Has `BaseWaterRecovery`.
4. **Medicine**: All other items (Oxygen, Bandages, etc.).

### Tier Definition (v2 Dynamic)
Calculated via `Talent-Path Distance` from Master Bench anchors:
- **0.0**: Harvested/Gathered (No recipe).
- **1.x**: Character / Campfire.
- **2.x**: Crafting Bench / Cooking Station.
- **3.x**: Machining Bench / Kitchen Stove.
- **4.x**: Fabricator / Electric Stove.

## üìä Data Processing
- **Recipe Matching**: Use keywords: `food, drink, beer, wine, soup, stew, pie, bread, cake, cookie, jam, juice, milk, tea, coffee, cocoa, smoothie, sorbet, pizza, pasta, salad, sandwich, roll, muffin, pastry, tart, animal, feed`.
- **Modifiers**: Break out 86+ unique effects into individual columns at the end of output.
- **Item Count**: Retain at least **300** consumables.

## üß™ Verification & Development
### After Modifying Code
1. **Run Parser**: `uv run python3 main.py`
2. **Check Output**: Verify `output/consumables_data.json` exists and item count > 300.
3. **Run Integrity Check**: `uv run python3 tests/verify_integrity.py` (MANDATORY).
4. **Run Tests**: `uv run python3 -m pytest tests/` (if applicable).

## ‚ö†Ô∏è Important Constraints
- **NO** string concatenation for paths.
- **NO** "N/A" for missing values (use `-` or blank).
- **NO** removal of items from `overrides/` without explicit approval.
- **NO** relative imports; all paths must resolve from project root.
- **NEVER** use `os.getcwd()`; use `Path(__file__)` or `path_resolver`.
- **NEVER** use `datetime.utcnow()` for timestamps; use `datetime.now(timezone.utc)`.
